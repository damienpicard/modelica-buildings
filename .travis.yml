group: deprecated-2017Q2

language: python
python:
  - "2.7"

cache: pip

notifications:
  email: false

git:
  depth: 10

services:
  - docker

env:
  - TEST_ARG="make test-documentation test-experiment-setup test-autogenerated-files"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Air"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Air"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Examples"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Examples"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.ThermalZones.Detailed.{BaseClasses,Constructions,Examples}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.ThermalZones.Detailed.{BaseClasses,Constructions,Examples}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.ThermalZones.Detailed.Validation.BESTEST.Cases6xx"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.ThermalZones.Detailed.Validation.BESTEST.Cases6xx"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.ThermalZones.Detailed.Validation.BESTEST.Cases9xx"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.ThermalZones.Detailed.Validation.BESTEST.Cases9xx"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.ThermalZones.Detailed.Validation.{Initialization,LBNL_71T,TestConditionalConstructions}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.ThermalZones.Detailed.Validation.{Initialization,LBNL_71T,TestConditionalConstructions}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.{Applications,Experimental}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.{Applications,Experimental}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Fluid.{Actuators,BaseClasses,Boilers,Chillers,Delays}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Fluid.{Actuators,BaseClasses,Boilers,Chillers,Delays}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Fluid.{Examples,FMI,FixedResistances}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Fluid.{Examples,FMI,FixedResistances}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Fluid.{HeatExchangers,HeatPumps,Interfaces}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Fluid.{HeatExchangers,HeatPumps,Interfaces}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Fluid.{MassExchangers,MixingVolumes,Movers,Sensors,SolarCollectors,Sources,Storage,Utilities}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Fluid.{MassExchangers,MixingVolumes,Movers,Sensors,SolarCollectors,Sources,Storage,Utilities}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.ThermalZones.Detailed.FLEXLAB"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.ThermalZones.Detailed.FLEXLAB"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.ThermalZones.ReducedOrder"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.ThermalZones.ReducedOrder"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Electrical"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Electrical"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.{Airflow,BoundaryConditions,Controls}"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.{Airflow,BoundaryConditions,Controls}"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.HeatTransfer"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.HeatTransfer"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Media"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Media"
  - TEST_ARG="make test-dymola    PACKAGE=Buildings.Utilities"
  - TEST_ARG="make test-jmodelica PACKAGE=Buildings.Utilities"

before_install:
  - sudo cp Buildings/Resources/Scripts/travis/usr/local/bin/dymola /usr/local/bin/
  - sudo cp Buildings/Resources/Scripts/travis/usr/local/bin/jm_ipython.sh /usr/local/bin/
  - sudo chmod +x /usr/local/bin/dymola
  - sudo chmod +x /usr/local/bin/jm_ipython.sh
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  - if [[ "$TEST_ARG" == *test-dymola* ]];    then docker pull "$DOCKER_USERNAME"/travis_ubuntu-1604_dymola-2018fd01-x86_64; fi;
  - if [[ "$TEST_ARG" == *test-jmodelica* ]]; then docker pull "$DOCKER_USERNAME"/ubuntu-1604_jmodelica_trunk;               fi;


# Install dependencies
# For sphinx, we need to install specific package versions, otherwise
# the html output may have small formatting differences which causes
# the test to fail
install:
  - pip install --upgrade pip setuptools wheel
  - pip install --only-binary=numpy,scipy,matplotlib numpy scipy matplotlib
  - pip install sphinx==1.5.1 sphinx-bootstrap-theme==0.4.13 \
      sphinxcontrib-bibtex==0.3.4 sphinxcontrib-plantuml==0.8.1 \
      alabaster==0.7.10 MarkupSafe==0.23 html5lib==0.999 \
      Pygments==2.1.3 snowballstemmer==1.2.1 docutils==0.13.1 \
      Babel==2.3.4 requests==2.12.4 Jinja2==2.8.1 latexcodec==1.0.4 \
      pybtex==0.20.1 pybtex-docutils==0.2.1 oset==0.1.3 PyYAML==3.12
  - pip install git+https://github.com/lbl-srg/BuildingsPy@master

# Execute tests
script:
  - (cd Buildings/Resources/Scripts/travis && travis_wait 90 $TEST_ARG)
